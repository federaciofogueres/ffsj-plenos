import { HttpClientModule } from '@angular/common/http';
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { FormControl, ReactiveFormsModule } from '@angular/forms';
import { FfsjAlertComponent } from "../ffsj-alert/ffsj-alert.component";
import * as i0 from "@angular/core";
import * as i1 from "./services/auth.service";
import * as i2 from "../ffsj-alert/ffsj-alert.service";
import * as i3 from "@angular/forms";
export class FfsjLoginComponent {
    constructor(authService, alertService) {
        this.authService = authService;
        this.alertService = alertService;
        this.title = 'Iniciar Sesión';
        this.subtitle = 'Acceso a administración';
        this.logStatus = new EventEmitter();
        this.username = new FormControl({ value: '', disabled: false });
        this.password = new FormControl('');
        this.repeatPassword = new FormControl('');
        this.loading = false;
        this.showChangePasswordForm = false;
        this.idAsociadoToChangePassword = -1;
    }
    ngOnInit() {
        if (this.authService.isLoggedIn()) {
            this.logStatus.emit(true);
        }
    }
    async login() {
        console.log('Doing Login -> ', this.username.value, this.password.value);
        this.loading = true;
        if (this.username.valid && this.password.valid) {
            console.log(`Username: ${this.username.value} - password: ${this.password.value}`);
            const codeLogin = await this.authService.login(this.username.value, this.password.value);
            if (codeLogin.code === 200) {
                this.loading = false;
                // this.alertService.success('Bienvenido!', 5000)
                this.logStatus.emit(true);
            }
            else if (codeLogin.code === 400) {
                this.loading = false;
                // this.alertService.danger('Datos incorrectos de inicio de sesión.', 5000)
                this.logStatus.emit(false);
            }
            else if (codeLogin.code === 201) {
                this.idAsociadoToChangePassword = codeLogin.id;
                this.showChangePasswordForm = true;
                this.username.disable();
                this.password.reset();
                this.loading = false;
            }
        }
        else {
            this.loading = false;
            this.alertService.danger('Datos incorrectos de inicio de sesión.', 5000);
            this.logStatus.emit(false);
        }
    }
    changePassword() {
        if (this.password.value !== this.repeatPassword.value) {
            this.alertService.danger('Las contraseñas no coinciden.', 5000);
            return;
        }
        this.authService.updatePassword(this.idAsociadoToChangePassword, this.password.value)
            .then((res) => {
            console.log(res);
            // this.alertService.success('Contraseña actualizada correctamente.', 5000);
            this.showChangePasswordForm = false;
            this.username.enable();
            this.login();
        })
            .catch((error) => {
            console.log(error);
            // this.alertService.danger('Error al actualizar la contraseña.', 5000);
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.11", ngImport: i0, type: FfsjLoginComponent, deps: [{ token: i1.AuthService }, { token: i2.FfsjAlertService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "17.3.11", type: FfsjLoginComponent, isStandalone: true, selector: "lib-ffsj-login", inputs: { title: "title", subtitle: "subtitle" }, outputs: { logStatus: "logStatus" }, ngImport: i0, template: "\r\n    <div class=\"container mt-4 login-container\">\r\n  \r\n      <div class=\"row banner\">\r\n        <h1>\r\n          <img src=\"https://intranet.hogueras.es/wp-content/uploads/2016/12/logofede.png\" class=\"img-fluid\" alt=\"\">\r\n          <span style=\"color: #dd5a43 !important\">{{title}}</span>\r\n        </h1>\r\n        <h4 style=\"color: #478fca !important; text-align: center;\">\u00A9 Federaci\u00F3 de Les Fogueres de Sant Joan</h4>\r\n      </div>\r\n  \r\n      <div class=\"row\">\r\n        <h4 class=\"titulo-consultas\" style=\"color: #478fca !important;\">\r\n          {{subtitle}}\r\n        </h4>\r\n      </div>\r\n      <div class=\"row my-3\">\r\n        <label for=\"username\">Usuario</label>\r\n        <input type=\"text\" id=\"username\" class=\"form-control\" [formControl]=\"username\" value=\"\">\r\n      </div>\r\n      @if (showChangePasswordForm) {\r\n        <div class=\"row mb-3\">\r\n          <label for=\"password\">Nueva contrase\u00F1a</label>\r\n        <input type=\"password\" id=\"password\" class=\"form-control\" [formControl]=\"password\" value=\"\">\r\n        </div>\r\n        <div class=\"row mb-3\">\r\n          <label for=\"repeatPassword\">Repite la nueva contrase\u00F1a</label>\r\n          <input type=\"password\" id=\"repeatPassword\" class=\"form-control\" [formControl]=\"repeatPassword\" value=\"\">\r\n        </div>\r\n      } @else {\r\n        <div class=\"row mb-3\">\r\n            <label for=\"password\">Contrase\u00F1a</label>\r\n          <input type=\"password\" id=\"password\" class=\"form-control\" [formControl]=\"password\" value=\"\">\r\n        </div>\r\n      }\r\n      @if(showChangePasswordForm) {\r\n        <div class=\"row submit-button mt-2\">\r\n          <button (click)=\"changePassword()\">Actualizar contrase\u00F1a</button>\r\n        </div>\r\n      } @else {\r\n        <div class=\"row submit-button mt-2\">\r\n          <button (click)=\"login()\">Iniciar sesi\u00F3n</button>\r\n        </div>\r\n      }\r\n  \r\n    </div>\r\n\r\n    <lib-ffsj-alert></lib-ffsj-alert>", styles: [".login-container{max-width:350px}.login-container .row.banner{text-align:center}.login-container .row.banner img{max-height:75px}.submit-button button{margin:auto;color:#fff;background-color:#0033a0;border:1px solid #0033A0;font-weight:700;padding:10px 20px;border-radius:25px;width:auto;max-width:80%}.row.banner{text-align:center}.row.banner img{max-height:75px}\n"], dependencies: [{ kind: "ngmodule", type: ReactiveFormsModule }, { kind: "directive", type: i3.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i3.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i3.FormControlDirective, selector: "[formControl]", inputs: ["formControl", "disabled", "ngModel"], outputs: ["ngModelChange"], exportAs: ["ngForm"] }, { kind: "ngmodule", type: HttpClientModule }, { kind: "component", type: FfsjAlertComponent, selector: "lib-ffsj-alert" }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.11", ngImport: i0, type: FfsjLoginComponent, decorators: [{
            type: Component,
            args: [{ selector: 'lib-ffsj-login', standalone: true, imports: [
                        ReactiveFormsModule,
                        HttpClientModule,
                        FfsjAlertComponent
                    ], template: "\r\n    <div class=\"container mt-4 login-container\">\r\n  \r\n      <div class=\"row banner\">\r\n        <h1>\r\n          <img src=\"https://intranet.hogueras.es/wp-content/uploads/2016/12/logofede.png\" class=\"img-fluid\" alt=\"\">\r\n          <span style=\"color: #dd5a43 !important\">{{title}}</span>\r\n        </h1>\r\n        <h4 style=\"color: #478fca !important; text-align: center;\">\u00A9 Federaci\u00F3 de Les Fogueres de Sant Joan</h4>\r\n      </div>\r\n  \r\n      <div class=\"row\">\r\n        <h4 class=\"titulo-consultas\" style=\"color: #478fca !important;\">\r\n          {{subtitle}}\r\n        </h4>\r\n      </div>\r\n      <div class=\"row my-3\">\r\n        <label for=\"username\">Usuario</label>\r\n        <input type=\"text\" id=\"username\" class=\"form-control\" [formControl]=\"username\" value=\"\">\r\n      </div>\r\n      @if (showChangePasswordForm) {\r\n        <div class=\"row mb-3\">\r\n          <label for=\"password\">Nueva contrase\u00F1a</label>\r\n        <input type=\"password\" id=\"password\" class=\"form-control\" [formControl]=\"password\" value=\"\">\r\n        </div>\r\n        <div class=\"row mb-3\">\r\n          <label for=\"repeatPassword\">Repite la nueva contrase\u00F1a</label>\r\n          <input type=\"password\" id=\"repeatPassword\" class=\"form-control\" [formControl]=\"repeatPassword\" value=\"\">\r\n        </div>\r\n      } @else {\r\n        <div class=\"row mb-3\">\r\n            <label for=\"password\">Contrase\u00F1a</label>\r\n          <input type=\"password\" id=\"password\" class=\"form-control\" [formControl]=\"password\" value=\"\">\r\n        </div>\r\n      }\r\n      @if(showChangePasswordForm) {\r\n        <div class=\"row submit-button mt-2\">\r\n          <button (click)=\"changePassword()\">Actualizar contrase\u00F1a</button>\r\n        </div>\r\n      } @else {\r\n        <div class=\"row submit-button mt-2\">\r\n          <button (click)=\"login()\">Iniciar sesi\u00F3n</button>\r\n        </div>\r\n      }\r\n  \r\n    </div>\r\n\r\n    <lib-ffsj-alert></lib-ffsj-alert>", styles: [".login-container{max-width:350px}.login-container .row.banner{text-align:center}.login-container .row.banner img{max-height:75px}.submit-button button{margin:auto;color:#fff;background-color:#0033a0;border:1px solid #0033A0;font-weight:700;padding:10px 20px;border-radius:25px;width:auto;max-width:80%}.row.banner{text-align:center}.row.banner img{max-height:75px}\n"] }]
        }], ctorParameters: () => [{ type: i1.AuthService }, { type: i2.FfsjAlertService }], propDecorators: { title: [{
                type: Input
            }], subtitle: [{
                type: Input
            }], logStatus: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmZzai1sb2dpbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9mZnNqLXdlYi1jb21wb25lbnRzL3NyYy9saWIvZmZzai1sb2dpbi9mZnNqLWxvZ2luLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2Zmc2otd2ViLWNvbXBvbmVudHMvc3JjL2xpYi9mZnNqLWxvZ2luL2Zmc2otbG9naW4uY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDeEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN2RSxPQUFPLEVBQUUsV0FBVyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDbEUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7Ozs7O0FBZXhFLE1BQU0sT0FBTyxrQkFBa0I7SUFlN0IsWUFDVSxXQUF3QixFQUN4QixZQUE4QjtRQUQ5QixnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUN4QixpQkFBWSxHQUFaLFlBQVksQ0FBa0I7UUFmL0IsVUFBSyxHQUFXLGdCQUFnQixDQUFDO1FBQ2pDLGFBQVEsR0FBVyx5QkFBeUIsQ0FBQztRQUU1QyxjQUFTLEdBQTBCLElBQUksWUFBWSxFQUFXLENBQUM7UUFFekUsYUFBUSxHQUFHLElBQUksV0FBVyxDQUFDLEVBQUMsS0FBSyxFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFDLENBQUMsQ0FBQztRQUN6RCxhQUFRLEdBQUcsSUFBSSxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDL0IsbUJBQWMsR0FBRyxJQUFJLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNyQyxZQUFPLEdBQVksS0FBSyxDQUFD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LHNCQUFzQixHQUFHLEtBQUssQ0FBQztZQUNwQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ3ZCLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNmLENBQUMsQ0FBQzthQUNELEtBQUssQ0FBQyxDQUFDLEtBQVUsRUFBRSxFQUFFO1lBQ3BCLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDbkIsd0VBQXdFO1FBQzFFLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQzsrR0F6RVUsa0JBQWtCO21HQUFsQixrQkFBa0IsaUtDbEIvQixzaUVBK0NxQyx1YURwQ2pDLG1CQUFtQix5a0JBQ25CLGdCQUFnQiwrQkFDaEIsa0JBQWtCOzs0RkFLVCxrQkFBa0I7a0JBWDlCLFNBQVM7K0JBQ0UsZ0JBQWdCLGNBQ2QsSUFBSSxXQUNQO3dCQUNQLG1CQUFtQjt3QkFDbkIsZ0JBQWdCO3dCQUNoQixrQkFBa0I7cUJBQ3JCOytHQU1VLEtBQUs7c0JBQWIsS0FBSztnQkFDRyxRQUFRO3NCQUFoQixLQUFLO2dCQUVJLFNBQVM7c0JBQWxCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIdHRwQ2xpZW50TW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBGb3JtQ29udHJvbCwgUmVhY3RpdmVGb3Jtc01vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgRmZzakFsZXJ0Q29tcG9uZW50IH0gZnJvbSBcIi4uL2Zmc2otYWxlcnQvZmZzai1hbGVydC5jb21wb25lbnRcIjtcclxuaW1wb3J0IHsgRmZzakFsZXJ0U2VydmljZSB9IGZyb20gJy4uL2Zmc2otYWxlcnQvZmZzai1hbGVydC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgQXV0aFNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL2F1dGguc2VydmljZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2xpYi1mZnNqLWxvZ2luJyxcclxuICBzdGFuZGFsb25lOiB0cnVlLFxyXG4gIGltcG9ydHM6IFtcclxuICAgIFJlYWN0aXZlRm9ybXNNb2R1bGUsXHJcbiAgICBIdHRwQ2xpZW50TW9kdWxlLFxyXG4gICAgRmZzakFsZXJ0Q29tcG9uZW50XHJcbl0sXHJcbiAgdGVtcGxhdGVVcmw6ICcuL2Zmc2otbG9naW4uY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsOiAnLi9mZnNqLWxvZ2luLmNvbXBvbmVudC5zY3NzJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgRmZzakxvZ2luQ29tcG9uZW50IHtcclxuXHJcbiAgQElucHV0KCkgdGl0bGU6IHN0cmluZyA9ICdJbmljaWFyIFNlc2nDs24nO1xyXG4gIEBJbnB1dCgpIHN1YnRpdGxlOiBzdHJpbmcgPSAnQWNjZXNvIGEgYWRtaW5pc3RyYWNpw7NuJztcclxuXHJcbiAgQE91dHB1dCgpIGxvZ1N0YXR1czogRXZlbnRFbWl0dGVyPGJvb2xlYW4+ID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xyXG5cclxuICB1c2VybmFtZSA9IG5ldyBGb3JtQ29udHJvbCh7dmFsdWU6ICcnLCBkaXNhYmxlZDogZmFsc2V9KTtcclxuICBwYXNzd29yZCA9IG5ldyBGb3JtQ29udHJvbCgnJyk7XHJcbiAgcmVwZWF0UGFzc3dvcmQgPSBuZXcgRm9ybUNvbnRyb2woJycpO1xyXG4gIGxvYWRpbmc6IGJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgc2hvd0NoYW5nZVBhc3N3b3JkRm9ybTogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIGlkQXNvY2lhZG9Ub0NoYW5nZVBhc3N3b3JkOiBudW1iZXIgPSAtMTtcclxuICBcclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgYXV0aFNlcnZpY2U6IEF1dGhTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBhbGVydFNlcnZpY2U6IEZmc2pBbGVydFNlcnZpY2VcclxuICApIHt9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgaWYgKHRoaXMuYXV0aFNlcnZpY2UuaXNMb2dnZWRJbigpKSB7XHJcbiAgICAgIHRoaXMubG9nU3RhdHVzLmVtaXQodHJ1ZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBsb2dpbigpIHtcclxuICAgIGNvbnNvbGUubG9nKCdEb2luZyBMb2dpbiAtPiAnLCB0aGlzLnVzZXJuYW1lLnZhbHVlLCB0aGlzLnBhc3N3b3JkLnZhbHVlKTtcclxuICAgIFxyXG4gICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTtcclxuICAgIGlmKHRoaXMudXNlcm5hbWUudmFsaWQgJiYgdGhpcy5wYXNzd29yZC52YWxpZCkge1xyXG4gICAgICBjb25zb2xlLmxvZyhgVXNlcm5hbWU6ICR7dGhpcy51c2VybmFtZS52YWx1ZX0gLSBwYXNzd29yZDogJHt0aGlzLnBhc3N3b3JkLnZhbHVlfWApO1xyXG4gICAgICBjb25zdCBjb2RlTG9naW46IGFueSA9IGF3YWl0IHRoaXMuYXV0aFNlcnZpY2UubG9naW4odGhpcy51c2VybmFtZS52YWx1ZSEsIHRoaXMucGFzc3dvcmQudmFsdWUhKTtcclxuICAgICAgaWYgKGNvZGVMb2dpbi5jb2RlID09PSAyMDApIHtcclxuICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAvLyB0aGlzLmFsZXJ0U2VydmljZS5zdWNjZXNzKCdCaWVudmVuaWRvIScsIDUwMDApXHJcbiAgICAgICAgdGhpcy5sb2dTdGF0dXMuZW1pdCh0cnVlKTtcclxuICAgICAgfSBlbHNlIGlmKGNvZGVMb2dpbi5jb2RlID09PSA0MDApIHtcclxuICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAvLyB0aGlzLmFsZXJ0U2VydmljZS5kYW5nZXIoJ0RhdG9zIGluY29ycmVjdG9zIGRlIGluaWNpbyBkZSBzZXNpw7NuLicsIDUwMDApXHJcbiAgICAgICAgdGhpcy5sb2dTdGF0dXMuZW1pdChmYWxzZSk7XHJcbiAgICAgIH0gZWxzZSBpZiAoY29kZUxvZ2luLmNvZGUgPT09IDIwMSkge1xyXG4gICAgICAgIHRoaXMuaWRBc29jaWFkb1RvQ2hhbmdlUGFzc3dvcmQgPSBjb2RlTG9naW4uaWQ7XHJcbiAgICAgICAgdGhpcy5zaG93Q2hhbmdlUGFzc3dvcmRGb3JtID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnVzZXJuYW1lLmRpc2FibGUoKTtcclxuICAgICAgICB0aGlzLnBhc3N3b3JkLnJlc2V0KCk7XHJcbiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICB0aGlzLmFsZXJ0U2VydmljZS5kYW5nZXIoJ0RhdG9zIGluY29ycmVjdG9zIGRlIGluaWNpbyBkZSBzZXNpw7NuLicsIDUwMDApXHJcbiAgICAgIHRoaXMubG9nU3RhdHVzLmVtaXQoZmFsc2UpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcblxyXG4gIGNoYW5nZVBhc3N3b3JkKCkge1xyXG4gICAgaWYgKHRoaXMucGFzc3dvcmQudmFsdWUgIT09IHRoaXMucmVwZWF0UGFzc3dvcmQudmFsdWUpIHtcclxuICAgICAgdGhpcy5hbGVydFNlcnZpY2UuZGFuZ2VyKCdMYXMgY29udHJhc2XDsWFzIG5vIGNvaW5jaWRlbi4nLCA1MDAwKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5hdXRoU2VydmljZS51cGRhdGVQYXNzd29yZCh0aGlzLmlkQXNvY2lhZG9Ub0NoYW5nZVBhc3N3b3JkLCB0aGlzLnBhc3N3b3JkLnZhbHVlISlcclxuICAgICAgLnRoZW4oKHJlczogYW55KSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2cocmVzKTtcclxuICAgICAgICAvLyB0aGlzLmFsZXJ0U2VydmljZS5zdWNjZXNzKCdDb250cmFzZcOxYSBhY3R1YWxpemFkYSBjb3JyZWN0YW1lbnRlLicsIDUwMDApO1xyXG4gICAgICAgIHRoaXMuc2hvd0NoYW5nZVBhc3N3b3JkRm9ybSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMudXNlcm5hbWUuZW5hYmxlKCk7XHJcbiAgICAgICAgdGhpcy5sb2dpbigpO1xyXG4gICAgICB9KVxyXG4gICAgICAuY2F0Y2goKGVycm9yOiBhbnkpID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XHJcbiAgICAgICAgLy8gdGhpcy5hbGVydFNlcnZpY2UuZGFuZ2VyKCdFcnJvciBhbCBhY3R1YWxpemFyIGxhIGNvbnRyYXNlw7FhLicsIDUwMDApO1xyXG4gICAgICB9KTtcclxuICB9XHJcbiAgXHJcbn1cclxuIiwiXHJcbiAgICA8ZGl2IGNsYXNzPVwiY29udGFpbmVyIG10LTQgbG9naW4tY29udGFpbmVyXCI+XHJcbiAgXHJcbiAgICAgIDxkaXYgY2xhc3M9XCJyb3cgYmFubmVyXCI+XHJcbiAgICAgICAgPGgxPlxyXG4gICAgICAgICAgPGltZyBzcmM9XCJodHRwczovL2ludHJhbmV0LmhvZ3VlcmFzLmVzL3dwLWNvbnRlbnQvdXBsb2Fkcy8yMDE2LzEyL2xvZ29mZWRlLnBuZ1wiIGNsYXNzPVwiaW1nLWZsdWlkXCIgYWx0PVwiXCI+XHJcbiAgICAgICAgICA8c3BhbiBzdHlsZT1cImNvbG9yOiAjZGQ1YTQzICFpbXBvcnRhbnRcIj57e3RpdGxlfX08L3NwYW4+XHJcbiAgICAgICAgPC9oMT5cclxuICAgICAgICA8aDQgc3R5bGU9XCJjb2xvcjogIzQ3OGZjYSAhaW1wb3J0YW50OyB0ZXh0LWFsaWduOiBjZW50ZXI7XCI+wqkgRmVkZXJhY2nDsyBkZSBMZXMgRm9ndWVyZXMgZGUgU2FudCBKb2FuPC9oND5cclxuICAgICAgPC9kaXY+XHJcbiAgXHJcbiAgICAgIDxkaXYgY2xhc3M9XCJyb3dcIj5cclxuICAgICAgICA8aDQgY2xhc3M9XCJ0aXR1bG8tY29uc3VsdGFzXCIgc3R5bGU9XCJjb2xvcjogIzQ3OGZjYSAhaW1wb3J0YW50O1wiPlxyXG4gICAgICAgICAge3tzdWJ0aXRsZX19XHJcbiAgICAgICAgPC9oND5cclxuICAgICAgPC9kaXY+XHJcbiAgICAgIDxkaXYgY2xhc3M9XCJyb3cgbXktM1wiPlxyXG4gICAgICAgIDxsYWJlbCBmb3I9XCJ1c2VybmFtZVwiPlVzdWFyaW88L2xhYmVsPlxyXG4gICAgICAgIDxpbnB1dCB0eXBlPVwidGV4dFwiIGlkPVwidXNlcm5hbWVcIiBjbGFzcz1cImZvcm0tY29udHJvbFwiIFtmb3JtQ29udHJvbF09XCJ1c2VybmFtZVwiIHZhbHVlPVwiXCI+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgICBAaWYgKHNob3dDaGFuZ2VQYXNzd29yZEZvcm0pIHtcclxuICAgICAgICA8ZGl2IGNsYXNzPVwicm93IG1iLTNcIj5cclxuICAgICAgICAgIDxsYWJlbCBmb3I9XCJwYXNzd29yZFwiPk51ZXZhIGNvbnRyYXNlw7FhPC9sYWJlbD5cclxuICAgICAgICA8aW5wdXQgdHlwZT1cInBhc3N3b3JkXCIgaWQ9XCJwYXNzd29yZFwiIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgW2Zvcm1Db250cm9sXT1cInBhc3N3b3JkXCIgdmFsdWU9XCJcIj5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgICA8ZGl2IGNsYXNzPVwicm93IG1iLTNcIj5cclxuICAgICAgICAgIDxsYWJlbCBmb3I9XCJyZXBlYXRQYXNzd29yZFwiPlJlcGl0ZSBsYSBudWV2YSBjb250cmFzZcOxYTwvbGFiZWw+XHJcbiAgICAgICAgICA8aW5wdXQgdHlwZT1cInBhc3N3b3JkXCIgaWQ9XCJyZXBlYXRQYXNzd29yZFwiIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgW2Zvcm1Db250cm9sXT1cInJlcGVhdFBhc3N3b3JkXCIgdmFsdWU9XCJcIj5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgfSBAZWxzZSB7XHJcbiAgICAgICAgPGRpdiBjbGFzcz1cInJvdyBtYi0zXCI+XHJcbiAgICAgICAgICAgIDxsYWJlbCBmb3I9XCJwYXNzd29yZFwiPkNvbnRyYXNlw7FhPC9sYWJlbD5cclxuICAgICAgICAgIDxpbnB1dCB0eXBlPVwicGFzc3dvcmRcIiBpZD1cInBhc3N3b3JkXCIgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBbZm9ybUNvbnRyb2xdPVwicGFzc3dvcmRcIiB2YWx1ZT1cIlwiPlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgICB9XHJcbiAgICAgIEBpZihzaG93Q2hhbmdlUGFzc3dvcmRGb3JtKSB7XHJcbiAgICAgICAgPGRpdiBjbGFzcz1cInJvdyBzdWJtaXQtYnV0dG9uIG10LTJcIj5cclxuICAgICAgICAgIDxidXR0b24gKGNsaWNrKT1cImNoYW5nZVBhc3N3b3JkKClcIj5BY3R1YWxpemFyIGNvbnRyYXNlw7FhPC9idXR0b24+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgIH0gQGVsc2Uge1xyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJyb3cgc3VibWl0LWJ1dHRvbiBtdC0yXCI+XHJcbiAgICAgICAgICA8YnV0dG9uIChjbGljayk9XCJsb2dpbigpXCI+SW5pY2lhciBzZXNpw7NuPC9idXR0b24+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgIH1cclxuICBcclxuICAgIDwvZGl2PlxyXG5cclxuICAgIDxsaWItZmZzai1hbGVydD48L2xpYi1mZnNqLWFsZXJ0PiJdfQ==