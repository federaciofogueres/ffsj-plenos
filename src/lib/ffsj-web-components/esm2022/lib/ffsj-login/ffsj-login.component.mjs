import { HttpClientModule } from '@angular/common/http';
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { FormControl, ReactiveFormsModule } from '@angular/forms';
import { FfsjAlertComponent } from "../ffsj-alert/ffsj-alert.component";
import * as i0 from "@angular/core";
import * as i1 from "./services/auth.service";
import * as i2 from "../ffsj-alert/ffsj-alert.service";
import * as i3 from "@angular/forms";
export class FfsjLoginComponent {
    constructor(authService, alertService) {
        this.authService = authService;
        this.alertService = alertService;
        this.title = 'Iniciar Sesión';
        this.subtitle = 'Acceso a administración';
        this.logStatus = new EventEmitter();
        this.username = new FormControl('');
        this.password = new FormControl('');
        this.repeatPassword = new FormControl('');
        this.loading = false;
        this.showChangePasswordForm = false;
        this.idAsociadoToChangePassword = -1;
    }
    ngOnInit() {
        if (this.authService.isLoggedIn()) {
            this.logStatus.emit(true);
        }
    }
    async login() {
        console.log('Doing Login -> ', this.username.value, this.password.value);
        this.loading = true;
        if (this.username.valid && this.password.valid) {
            console.log(`Username: ${this.username.value} - password: ${this.password.value}`);
            const codeLogin = await this.authService.login(this.username.value, this.password.value);
            if (codeLogin.code === 200) {
                this.loading = false;
                // this.alertService.success('Bienvenido!', 5000)
                this.logStatus.emit(true);
            }
            else if (codeLogin.code === 400) {
                this.loading = false;
                // this.alertService.danger('Datos incorrectos de inicio de sesión.', 5000)
                this.logStatus.emit(false);
            }
            else if (codeLogin.code === 201) {
                this.idAsociadoToChangePassword = codeLogin.id;
                this.showChangePasswordForm = true;
                this.password.reset();
                this.loading = false;
            }
        }
    }
    changePassword() {
        if (this.password.value !== this.repeatPassword.value) {
            this.alertService.danger('Las contraseñas no coinciden.', 5000);
            return;
        }
        this.authService.updatePassword(this.idAsociadoToChangePassword, this.password.value)
            .then((res) => {
            console.log(res);
            // this.alertService.success('Contraseña actualizada correctamente.', 5000);
            this.showChangePasswordForm = false;
            this.login();
        })
            .catch((error) => {
            console.log(error);
            // this.alertService.danger('Error al actualizar la contraseña.', 5000);
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.11", ngImport: i0, type: FfsjLoginComponent, deps: [{ token: i1.AuthService }, { token: i2.FfsjAlertService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "17.3.11", type: FfsjLoginComponent, isStandalone: true, selector: "lib-ffsj-login", inputs: { title: "title", subtitle: "subtitle" }, outputs: { logStatus: "logStatus" }, ngImport: i0, template: "\r\n    <div class=\"container mt-4 login-container\">\r\n  \r\n      <div class=\"row banner\">\r\n        <h1>\r\n          <img src=\"https://intranet.hogueras.es/wp-content/uploads/2016/12/logofede.png\" class=\"img-fluid\" alt=\"\">\r\n          <span style=\"color: #dd5a43 !important\">{{title}}</span>\r\n        </h1>\r\n        <h4 style=\"color: #478fca !important; text-align: center;\">\u00A9 Federaci\u00F3 de Les Fogueres de Sant Joan</h4>\r\n      </div>\r\n  \r\n      <div class=\"row\">\r\n        <h4 class=\"titulo-consultas\" style=\"color: #478fca !important;\">\r\n          {{subtitle}}\r\n        </h4>\r\n      </div>\r\n      <div class=\"row my-3\">\r\n        <label for=\"username\">Usuario</label>\r\n        <input type=\"text\" id=\"username\" class=\"form-control\" [formControl]=\"username\" value=\"\">\r\n      </div>\r\n      @if (showChangePasswordForm) {\r\n        <div class=\"row mb-3\">\r\n          <label for=\"password\">Nueva contrase\u00F1a</label>\r\n        <input type=\"password\" id=\"password\" class=\"form-control\" [formControl]=\"password\" value=\"\">\r\n        </div>\r\n        <div class=\"row mb-3\">\r\n          <label for=\"repeatPassword\">Repite la nueva contrase\u00F1a</label>\r\n          <input type=\"password\" id=\"repeatPassword\" class=\"form-control\" [formControl]=\"repeatPassword\" value=\"\">\r\n        </div>\r\n      } @else {\r\n        <div class=\"row mb-3\">\r\n            <label for=\"password\">Contrase\u00F1a</label>\r\n          <input type=\"password\" id=\"password\" class=\"form-control\" [formControl]=\"password\" value=\"\">\r\n        </div>\r\n      }\r\n      @if(showChangePasswordForm) {\r\n        <div class=\"row submit-button mt-2\">\r\n          <button (click)=\"changePassword()\">Actualizar contrase\u00F1a</button>\r\n        </div>\r\n      } @else {\r\n        <div class=\"row submit-button mt-2\">\r\n          <button (click)=\"login()\">Iniciar sesi\u00F3n</button>\r\n        </div>\r\n      }\r\n  \r\n    </div>\r\n\r\n    <lib-ffsj-alert></lib-ffsj-alert>", styles: [".login-container{max-width:350px}.login-container .row.banner{text-align:center}.login-container .row.banner img{max-height:75px}.submit-button button{margin:auto;color:#fff;background-color:#0033a0;border:1px solid #0033A0;font-weight:700;padding:10px 20px;border-radius:25px;width:auto;max-width:80%}.row.banner{text-align:center}.row.banner img{max-height:75px}\n"], dependencies: [{ kind: "ngmodule", type: ReactiveFormsModule }, { kind: "directive", type: i3.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i3.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i3.FormControlDirective, selector: "[formControl]", inputs: ["formControl", "disabled", "ngModel"], outputs: ["ngModelChange"], exportAs: ["ngForm"] }, { kind: "ngmodule", type: HttpClientModule }, { kind: "component", type: FfsjAlertComponent, selector: "lib-ffsj-alert" }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.11", ngImport: i0, type: FfsjLoginComponent, decorators: [{
            type: Component,
            args: [{ selector: 'lib-ffsj-login', standalone: true, imports: [
                        ReactiveFormsModule,
                        HttpClientModule,
                        FfsjAlertComponent
                    ], template: "\r\n    <div class=\"container mt-4 login-container\">\r\n  \r\n      <div class=\"row banner\">\r\n        <h1>\r\n          <img src=\"https://intranet.hogueras.es/wp-content/uploads/2016/12/logofede.png\" class=\"img-fluid\" alt=\"\">\r\n          <span style=\"color: #dd5a43 !important\">{{title}}</span>\r\n        </h1>\r\n        <h4 style=\"color: #478fca !important; text-align: center;\">\u00A9 Federaci\u00F3 de Les Fogueres de Sant Joan</h4>\r\n      </div>\r\n  \r\n      <div class=\"row\">\r\n        <h4 class=\"titulo-consultas\" style=\"color: #478fca !important;\">\r\n          {{subtitle}}\r\n        </h4>\r\n      </div>\r\n      <div class=\"row my-3\">\r\n        <label for=\"username\">Usuario</label>\r\n        <input type=\"text\" id=\"username\" class=\"form-control\" [formControl]=\"username\" value=\"\">\r\n      </div>\r\n      @if (showChangePasswordForm) {\r\n        <div class=\"row mb-3\">\r\n          <label for=\"password\">Nueva contrase\u00F1a</label>\r\n        <input type=\"password\" id=\"password\" class=\"form-control\" [formControl]=\"password\" value=\"\">\r\n        </div>\r\n        <div class=\"row mb-3\">\r\n          <label for=\"repeatPassword\">Repite la nueva contrase\u00F1a</label>\r\n          <input type=\"password\" id=\"repeatPassword\" class=\"form-control\" [formControl]=\"repeatPassword\" value=\"\">\r\n        </div>\r\n      } @else {\r\n        <div class=\"row mb-3\">\r\n            <label for=\"password\">Contrase\u00F1a</label>\r\n          <input type=\"password\" id=\"password\" class=\"form-control\" [formControl]=\"password\" value=\"\">\r\n        </div>\r\n      }\r\n      @if(showChangePasswordForm) {\r\n        <div class=\"row submit-button mt-2\">\r\n          <button (click)=\"changePassword()\">Actualizar contrase\u00F1a</button>\r\n        </div>\r\n      } @else {\r\n        <div class=\"row submit-button mt-2\">\r\n          <button (click)=\"login()\">Iniciar sesi\u00F3n</button>\r\n        </div>\r\n      }\r\n  \r\n    </div>\r\n\r\n    <lib-ffsj-alert></lib-ffsj-alert>", styles: [".login-container{max-width:350px}.login-container .row.banner{text-align:center}.login-container .row.banner img{max-height:75px}.submit-button button{margin:auto;color:#fff;background-color:#0033a0;border:1px solid #0033A0;font-weight:700;padding:10px 20px;border-radius:25px;width:auto;max-width:80%}.row.banner{text-align:center}.row.banner img{max-height:75px}\n"] }]
        }], ctorParameters: () => [{ type: i1.AuthService }, { type: i2.FfsjAlertService }], propDecorators: { title: [{
                type: Input
            }], subtitle: [{
                type: Input
            }], logStatus: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmZzai1sb2dpbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9mZnNqLXdlYi1jb21wb25lbnRzL3NyYy9saWIvZmZzai1sb2dpbi9mZnNqLWxvZ2luLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2Zmc2otd2ViLWNvbXBvbmVudHMvc3JjL2xpYi9mZnNqLWxvZ2luL2Zmc2otbG9naW4uY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDeEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN2RSxPQUFPLEVBQUUsV0FBVyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDbEUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7Ozs7O0FBZXhFLE1BQU0sT0FBTyxrQkFBa0I7SUFlN0IsWUFDVSxXQUF3QixFQUN4QixZQUE4QjtRQUQ5QixnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUN4QixpQkFBWSxHQUFaLFlBQVksQ0FBa0I7UUFmL0IsVUFBSyxHQUFXLGdCQUFnQixDQUFDO1FBQ2pDLGFBQVEsR0FBVyx5QkFBeUIsQ0FBQztRQUU1QyxjQUFTLEdBQTBCLElBQUksWUFBWSxFQUFXLENBQUM7UUFFekUsYUFBUSxHQUFHLElBQUksV0FBVyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQy9CLGFBQVEsR0FBRyxJQUFJLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUMvQixtQkFBYyxHQUFHLElBQUksV0FBVyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3JDLFlBQU8sR0FBWSxLQUFLLENBQUM7UUFFekIsMkJBQXNCLEdBQVksS0FBSyxDQUFDO1FBQ3hDLCtCQUEw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QUNuQixnQkFBZ0IsK0JBQ2hCLGtCQUFrQjs7NEZBS1Qsa0JBQWtCO2tCQVg5QixTQUFTOytCQUNFLGdCQUFnQixjQUNkLElBQUksV0FDUDt3QkFDUCxtQkFBbUI7d0JBQ25CLGdCQUFnQjt3QkFDaEIsa0JBQWtCO3FCQUNyQjsrR0FNVSxLQUFLO3NCQUFiLEtBQUs7Z0JBQ0csUUFBUTtzQkFBaEIsS0FBSztnQkFFSSxTQUFTO3NCQUFsQixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cENsaWVudE1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRm9ybUNvbnRyb2wsIFJlYWN0aXZlRm9ybXNNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IEZmc2pBbGVydENvbXBvbmVudCB9IGZyb20gXCIuLi9mZnNqLWFsZXJ0L2Zmc2otYWxlcnQuY29tcG9uZW50XCI7XHJcbmltcG9ydCB7IEZmc2pBbGVydFNlcnZpY2UgfSBmcm9tICcuLi9mZnNqLWFsZXJ0L2Zmc2otYWxlcnQuc2VydmljZSc7XHJcbmltcG9ydCB7IEF1dGhTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy9hdXRoLnNlcnZpY2UnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdsaWItZmZzai1sb2dpbicsXHJcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcclxuICBpbXBvcnRzOiBbXHJcbiAgICBSZWFjdGl2ZUZvcm1zTW9kdWxlLFxyXG4gICAgSHR0cENsaWVudE1vZHVsZSxcclxuICAgIEZmc2pBbGVydENvbXBvbmVudFxyXG5dLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9mZnNqLWxvZ2luLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybDogJy4vZmZzai1sb2dpbi5jb21wb25lbnQuc2NzcydcclxufSlcclxuZXhwb3J0IGNsYXNzIEZmc2pMb2dpbkNvbXBvbmVudCB7XHJcblxyXG4gIEBJbnB1dCgpIHRpdGxlOiBzdHJpbmcgPSAnSW5pY2lhciBTZXNpw7NuJztcclxuICBASW5wdXQoKSBzdWJ0aXRsZTogc3RyaW5nID0gJ0FjY2VzbyBhIGFkbWluaXN0cmFjacOzbic7XHJcblxyXG4gIEBPdXRwdXQoKSBsb2dTdGF0dXM6IEV2ZW50RW1pdHRlcjxib29sZWFuPiA9IG5ldyBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4oKTtcclxuXHJcbiAgdXNlcm5hbWUgPSBuZXcgRm9ybUNvbnRyb2woJycpO1xyXG4gIHBhc3N3b3JkID0gbmV3IEZvcm1Db250cm9sKCcnKTtcclxuICByZXBlYXRQYXNzd29yZCA9IG5ldyBGb3JtQ29udHJvbCgnJyk7XHJcbiAgbG9hZGluZzogYm9vbGVhbiA9IGZhbHNlO1xyXG5cclxuICBzaG93Q2hhbmdlUGFzc3dvcmRGb3JtOiBib29sZWFuID0gZmFsc2U7XHJcbiAgaWRBc29jaWFkb1RvQ2hhbmdlUGFzc3dvcmQ6IG51bWJlciA9IC0xO1xyXG4gIFxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBhdXRoU2VydmljZTogQXV0aFNlcnZpY2UsXHJcbiAgICBwcml2YXRlIGFsZXJ0U2VydmljZTogRmZzakFsZXJ0U2VydmljZVxyXG4gICkge31cclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICBpZiAodGhpcy5hdXRoU2VydmljZS5pc0xvZ2dlZEluKCkpIHtcclxuICAgICAgdGhpcy5sb2dTdGF0dXMuZW1pdCh0cnVlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIGxvZ2luKCkge1xyXG4gICAgY29uc29sZS5sb2coJ0RvaW5nIExvZ2luIC0+ICcsIHRoaXMudXNlcm5hbWUudmFsdWUsIHRoaXMucGFzc3dvcmQudmFsdWUpO1xyXG4gICAgXHJcbiAgICB0aGlzLmxvYWRpbmcgPSB0cnVlO1xyXG4gICAgaWYodGhpcy51c2VybmFtZS52YWxpZCAmJiB0aGlzLnBhc3N3b3JkLnZhbGlkKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGBVc2VybmFtZTogJHt0aGlzLnVzZXJuYW1lLnZhbHVlfSAtIHBhc3N3b3JkOiAke3RoaXMucGFzc3dvcmQudmFsdWV9YCk7XHJcbiAgICAgIGNvbnN0IGNvZGVMb2dpbjogYW55ID0gYXdhaXQgdGhpcy5hdXRoU2VydmljZS5sb2dpbih0aGlzLnVzZXJuYW1lLnZhbHVlISwgdGhpcy5wYXNzd29yZC52YWx1ZSEpO1xyXG4gICAgICBpZiAoY29kZUxvZ2luLmNvZGUgPT09IDIwMCkge1xyXG4gICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgIC8vIHRoaXMuYWxlcnRTZXJ2aWNlLnN1Y2Nlc3MoJ0JpZW52ZW5pZG8hJywgNTAwMClcclxuICAgICAgICB0aGlzLmxvZ1N0YXR1cy5lbWl0KHRydWUpO1xyXG4gICAgICB9IGVsc2UgaWYoY29kZUxvZ2luLmNvZGUgPT09IDQwMCkge1xyXG4gICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgIC8vIHRoaXMuYWxlcnRTZXJ2aWNlLmRhbmdlcignRGF0b3MgaW5jb3JyZWN0b3MgZGUgaW5pY2lvIGRlIHNlc2nDs24uJywgNTAwMClcclxuICAgICAgICB0aGlzLmxvZ1N0YXR1cy5lbWl0KGZhbHNlKTtcclxuICAgICAgfSBlbHNlIGlmIChjb2RlTG9naW4uY29kZSA9PT0gMjAxKSB7XHJcbiAgICAgICAgdGhpcy5pZEFzb2NpYWRvVG9DaGFuZ2VQYXNzd29yZCA9IGNvZGVMb2dpbi5pZDtcclxuICAgICAgICB0aGlzLnNob3dDaGFuZ2VQYXNzd29yZEZvcm0gPSB0cnVlO1xyXG4gICAgICAgIHRoaXMucGFzc3dvcmQucmVzZXQoKTtcclxuICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcblxyXG4gIGNoYW5nZVBhc3N3b3JkKCkge1xyXG4gICAgaWYgKHRoaXMucGFzc3dvcmQudmFsdWUgIT09IHRoaXMucmVwZWF0UGFzc3dvcmQudmFsdWUpIHtcclxuICAgICAgdGhpcy5hbGVydFNlcnZpY2UuZGFuZ2VyKCdMYXMgY29udHJhc2XDsWFzIG5vIGNvaW5jaWRlbi4nLCA1MDAwKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5hdXRoU2VydmljZS51cGRhdGVQYXNzd29yZCh0aGlzLmlkQXNvY2lhZG9Ub0NoYW5nZVBhc3N3b3JkLCB0aGlzLnBhc3N3b3JkLnZhbHVlISlcclxuICAgICAgLnRoZW4oKHJlczogYW55KSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2cocmVzKTtcclxuICAgICAgICAvLyB0aGlzLmFsZXJ0U2VydmljZS5zdWNjZXNzKCdDb250cmFzZcOxYSBhY3R1YWxpemFkYSBjb3JyZWN0YW1lbnRlLicsIDUwMDApO1xyXG4gICAgICAgIHRoaXMuc2hvd0NoYW5nZVBhc3N3b3JkRm9ybSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMubG9naW4oKTtcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKChlcnJvcjogYW55KSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xyXG4gICAgICAgIC8vIHRoaXMuYWxlcnRTZXJ2aWNlLmRhbmdlcignRXJyb3IgYWwgYWN0dWFsaXphciBsYSBjb250cmFzZcOxYS4nLCA1MDAwKTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG4gIFxyXG59XHJcbiIsIlxyXG4gICAgPGRpdiBjbGFzcz1cImNvbnRhaW5lciBtdC00IGxvZ2luLWNvbnRhaW5lclwiPlxyXG4gIFxyXG4gICAgICA8ZGl2IGNsYXNzPVwicm93IGJhbm5lclwiPlxyXG4gICAgICAgIDxoMT5cclxuICAgICAgICAgIDxpbWcgc3JjPVwiaHR0cHM6Ly9pbnRyYW5ldC5ob2d1ZXJhcy5lcy93cC1jb250ZW50L3VwbG9hZHMvMjAxNi8xMi9sb2dvZmVkZS5wbmdcIiBjbGFzcz1cImltZy1mbHVpZFwiIGFsdD1cIlwiPlxyXG4gICAgICAgICAgPHNwYW4gc3R5bGU9XCJjb2xvcjogI2RkNWE0MyAhaW1wb3J0YW50XCI+e3t0aXRsZX19PC9zcGFuPlxyXG4gICAgICAgIDwvaDE+XHJcbiAgICAgICAgPGg0IHN0eWxlPVwiY29sb3I6ICM0NzhmY2EgIWltcG9ydGFudDsgdGV4dC1hbGlnbjogY2VudGVyO1wiPsKpIEZlZGVyYWNpw7MgZGUgTGVzIEZvZ3VlcmVzIGRlIFNhbnQgSm9hbjwvaDQ+XHJcbiAgICAgIDwvZGl2PlxyXG4gIFxyXG4gICAgICA8ZGl2IGNsYXNzPVwicm93XCI+XHJcbiAgICAgICAgPGg0IGNsYXNzPVwidGl0dWxvLWNvbnN1bHRhc1wiIHN0eWxlPVwiY29sb3I6ICM0NzhmY2EgIWltcG9ydGFudDtcIj5cclxuICAgICAgICAgIHt7c3VidGl0bGV9fVxyXG4gICAgICAgIDwvaDQ+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgICA8ZGl2IGNsYXNzPVwicm93IG15LTNcIj5cclxuICAgICAgICA8bGFiZWwgZm9yPVwidXNlcm5hbWVcIj5Vc3VhcmlvPC9sYWJlbD5cclxuICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIiBpZD1cInVzZXJuYW1lXCIgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBbZm9ybUNvbnRyb2xdPVwidXNlcm5hbWVcIiB2YWx1ZT1cIlwiPlxyXG4gICAgICA8L2Rpdj5cclxuICAgICAgQGlmIChzaG93Q2hhbmdlUGFzc3dvcmRGb3JtKSB7XHJcbiAgICAgICAgPGRpdiBjbGFzcz1cInJvdyBtYi0zXCI+XHJcbiAgICAgICAgICA8bGFiZWwgZm9yPVwicGFzc3dvcmRcIj5OdWV2YSBjb250cmFzZcOxYTwvbGFiZWw+XHJcbiAgICAgICAgPGlucHV0IHR5cGU9XCJwYXNzd29yZFwiIGlkPVwicGFzc3dvcmRcIiBjbGFzcz1cImZvcm0tY29udHJvbFwiIFtmb3JtQ29udHJvbF09XCJwYXNzd29yZFwiIHZhbHVlPVwiXCI+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPGRpdiBjbGFzcz1cInJvdyBtYi0zXCI+XHJcbiAgICAgICAgICA8bGFiZWwgZm9yPVwicmVwZWF0UGFzc3dvcmRcIj5SZXBpdGUgbGEgbnVldmEgY29udHJhc2XDsWE8L2xhYmVsPlxyXG4gICAgICAgICAgPGlucHV0IHR5cGU9XCJwYXNzd29yZFwiIGlkPVwicmVwZWF0UGFzc3dvcmRcIiBjbGFzcz1cImZvcm0tY29udHJvbFwiIFtmb3JtQ29udHJvbF09XCJyZXBlYXRQYXNzd29yZFwiIHZhbHVlPVwiXCI+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgIH0gQGVsc2Uge1xyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJyb3cgbWItM1wiPlxyXG4gICAgICAgICAgICA8bGFiZWwgZm9yPVwicGFzc3dvcmRcIj5Db250cmFzZcOxYTwvbGFiZWw+XHJcbiAgICAgICAgICA8aW5wdXQgdHlwZT1cInBhc3N3b3JkXCIgaWQ9XCJwYXNzd29yZFwiIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgW2Zvcm1Db250cm9sXT1cInBhc3N3b3JkXCIgdmFsdWU9XCJcIj5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgfVxyXG4gICAgICBAaWYoc2hvd0NoYW5nZVBhc3N3b3JkRm9ybSkge1xyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJyb3cgc3VibWl0LWJ1dHRvbiBtdC0yXCI+XHJcbiAgICAgICAgICA8YnV0dG9uIChjbGljayk9XCJjaGFuZ2VQYXNzd29yZCgpXCI+QWN0dWFsaXphciBjb250cmFzZcOxYTwvYnV0dG9uPlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgICB9IEBlbHNlIHtcclxuICAgICAgICA8ZGl2IGNsYXNzPVwicm93IHN1Ym1pdC1idXR0b24gbXQtMlwiPlxyXG4gICAgICAgICAgPGJ1dHRvbiAoY2xpY2spPVwibG9naW4oKVwiPkluaWNpYXIgc2VzacOzbjwvYnV0dG9uPlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgICB9XHJcbiAgXHJcbiAgICA8L2Rpdj5cclxuXHJcbiAgICA8bGliLWZmc2otYWxlcnQ+PC9saWItZmZzai1hbGVydD4iXX0=